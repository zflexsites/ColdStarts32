const fe="modulepreload",pe=function(e){return"/"+e},G={},L=function(t,n,o){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));r=Promise.allSettled(n.map(l=>{if(l=pe(l),l in G)return;G[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":fe,c||(d.as="script"),d.crossOrigin="",d.href=l,i&&d.setAttribute("nonce",i),document.head.appendChild(d),c)return new Promise((p,m)=>{d.addEventListener("load",p),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return r.then(s=>{for(const i of s||[])i.status==="rejected"&&a(i.reason);return t().catch(a)})};let x=[],Q=!1,$=null;async function A(){if(Q)return x;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur réseau: ${e.statusText}`);return x=await e.json(),Q=!0,x}catch(e){return console.error("[FilterSort] Impossible de charger l'index des produits:",e),[]}}function ge(e,t){const n=[...e];switch(t){case"price-asc":n.sort((o,r)=>o.price.amount-r.price.amount);break;case"price-desc":n.sort((o,r)=>r.price.amount-o.price.amount);break;case"name-asc":n.sort((o,r)=>o.title.localeCompare(r.title));break;case"name-desc":n.sort((o,r)=>r.title.localeCompare(o.title));break}return n}function ye(e){const t=document.getElementById("product-grid");if(t){if(!$){const n=t.querySelector(".product-card");if(!n)return;$=n.cloneNode(!0)}if(t.innerHTML="",e.length===0){t.innerHTML='<p class="col-span-full text-center text-gray-500 py-8">Aucun produit ne correspond à votre sélection.</p>';return}e.forEach(n=>{const o=$.cloneNode(!0),r=o.querySelector("a"),a=o.querySelector("img"),s=o.querySelector("h4"),i=o.querySelector(".product-price");r&&(r.href=n.url),a&&(a.src=n.coverImage,a.alt=n.title),s&&(s.textContent=n.title),i&&n.price&&(i.textContent=`${n.price.amount.toFixed(2)} ${n.price.currency}`),t.appendChild(o)})}}async function he(){if(!document.getElementById("product-controls"))return;await A();const t=JSON.parse(document.getElementById("zflex-data").textContent),n=t.category?t.category.id:null;if(!n)return;const o=x.filter(c=>c.categoryId===n),r=document.getElementById("sort-dropdown");if(!r)return;const a=document.getElementById("sort-btn"),s=document.getElementById("sort-label"),i=document.getElementById("sort-options"),l=i.querySelectorAll(".sort-option");a.addEventListener("click",c=>{c.stopPropagation(),i.classList.toggle("hidden")}),l.forEach(c=>{c.addEventListener("click",u=>{u.preventDefault();const d=c.dataset.value,p=c.textContent;s.textContent=`Trier par : ${p}`,i.classList.add("hidden");const m=ge(o,d);ye(m)})}),document.addEventListener("click",c=>{r.contains(c.target)||i.classList.add("hidden")}),console.log("[FilterSort] Module initialisé.")}const ve=Object.freeze(Object.defineProperty({__proto__:null,fetchProductIndex:A,initFilterSort:he},Symbol.toStringTag,{value:"Module"})),S=window.zflexEventBus||new EventTarget;window.zflexEventBus=S;let g,D,N,R,M,_,B,P;function Y(){g&&g.classList.add("hidden")}function re(e,t,n="info"){if(!g){alert(`${e}

${t}`);return}_.classList.add("hidden"),B.classList.add("hidden"),P.classList.add("hidden"),n==="success"?_.classList.remove("hidden"):n==="error"?B.classList.remove("hidden"):P.classList.remove("hidden"),N.textContent=e,R.textContent=t,g.classList.remove("hidden")}function Ee(){if(g=document.getElementById("zflex-dialog"),!!g){if(D=document.getElementById("dialog-overlay"),N=document.getElementById("dialog-title"),R=document.getElementById("dialog-message"),M=document.getElementById("dialog-confirm-btn"),_=document.getElementById("dialog-icon-success"),B=document.getElementById("dialog-icon-error"),P=document.getElementById("dialog-icon-info"),!D||!N||!R||!M||!_||!B||!P){console.error("[Dialog] Un ou plusieurs éléments internes du dialog sont manquants. Vérifie les IDs."),g=null;return}D.addEventListener("click",Y),M.addEventListener("click",Y),S.addEventListener("dialog:show",e=>{const{title:t,message:n,variant:o}=e.detail;re(t,n,o)}),console.log("[Dialog] Module initialisé et prêt.")}}const se="zflex_cart";function I(){return JSON.parse(localStorage.getItem(se))||[]}function q(e){localStorage.setItem(se,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function we(e,t=1){const n=I(),o=n.find(r=>r.id===e.id);o?o.quantity+=t:n.push({id:e.id,title:e.title,price:e.price,coverImage:e.coverImage,url:e.url,quantity:t}),q(n)}function Se(e,t){let n=I();const o=n.find(r=>r.id===e);o&&(t>0?o.quantity=t:n=n.filter(r=>r.id!==e),q(n))}function Ie(e){const t=I().filter(n=>n.id!==e);q(t)}function at(){q([])}function X(){const e=document.getElementById("cart-count");if(!e)return;const n=I().reduce((o,r)=>o+r.quantity,0);e.textContent=n,e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function ae(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),o=document.getElementById("cart-total"),r=document.getElementById("cart-empty-state"),a=document.getElementById("cart-content");if(!t||!n||!o||!r||!a){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const s=I(),i=document.getElementById("cart-item-template");if(!i){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(s.length===0){r.classList.remove("hidden"),a.classList.add("hidden");return}r.classList.add("hidden"),a.classList.remove("hidden"),t.innerHTML="";let l={};s.forEach(c=>{var W,K;const u=Number(((W=c.price)==null?void 0:W.amount)||0),d=((K=c.price)==null?void 0:K.currency)||"EUR",p=Number(c.quantity||1),m=i.content.cloneNode(!0);m.querySelector('[data-template-field="image"]').src=c.coverImage||"",m.querySelector('[data-template-field="title"]').textContent=c.title||"Produit sans nom",m.querySelector('[data-template-field="url"]').href=c.url||"#",m.querySelector('[data-template-field="price"]').textContent=`${u.toFixed(2)} ${d}`;const O=m.querySelector('[data-template-field="quantity"]');O.value=p,m.querySelector('[data-template-field="total"]').textContent=`${(u*p).toFixed(2)} ${d}`,O.addEventListener("change",()=>Se(c.id,parseInt(O.value,10))),m.querySelector('[data-template-field="remove-btn"]').addEventListener("click",()=>Ie(c.id)),t.appendChild(m),l[d]||(l[d]=0),l[d]+=u*p}),n.innerHTML="",o.innerHTML="",Object.entries(l).forEach(([c,u])=>{const d=`${Number(u).toFixed(2)} ${c}`;n.innerHTML+=`<div>${d}</div>`,o.innerHTML+=`<div>${d}</div>`})}function Le(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),ae())}async function be(){document.querySelectorAll("#add-to-cart-btn").forEach(e=>{e.dataset.listenerAttached||(e.addEventListener("click",async()=>{e.disabled=!0;try{const t=document.getElementById("zflex-data");if(!t)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const n=JSON.parse(t.textContent);if(!(n!=null&&n.product))throw new Error("Données du produit non trouvées dans le tunnel de data.");const r=(await A()).find(a=>a.id===n.product.id);if(r)we(r),S.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajouté au panier !",message:`${r.title.trim()} a bien été ajouté.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(t){console.error("Erreur lors de l'ajout au panier:",t),S.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:t.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{e.disabled=!1}}),e.dataset.listenerAttached="true")})}function Ce(){X(),window.addEventListener("cartUpdated",()=>{X(),ae()}),console.log("[Cart] Module global initialisé.")}async function v(e,t){var r;const o=(r=ue().apiEndpoints)==null?void 0:r[e];if(!o)throw new Error(`Endpoint API pour "${e}" non trouvé. Vérifiez la configuration du builder.`);try{const a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await a.json();if(!a.ok){const i=s.error||`Erreur ${a.status}`;throw new Error(i)}return s}catch(a){throw console.error(`[API] Erreur pour "${e}":`,a),new Error("La communication avec nos services a échoué. Veuillez réessayer.")}}function xe(e,t){return v("createConv",{storeId:e,context:t})}function ke(e,t,n,o){return v("stacy",{storeId:e,convId:t,message:n,contextDelta:o})}function _e(e,t,n){return v("resumeConv",{storeId:e,convId:t,keepMessagesPreview:n})}function it(e,t){return v("createOrder",{...e,storeId:t})}function ct(e,t){return v("getOrderDetails",{orderId:e,storeId:t})}function Be(e,t){return v("trackEvent",{storeId:e,events:t})}const Pe=24*60*60*1e3,Te=e=>`stacy_conv_${e}`;let h=!1,H=[],Z=!1,j=null;function J(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] getPageData parse error",e),{}}}async function Ae(e,t){const n=Te(e);try{const o=localStorage.getItem(n);if(o){const s=JSON.parse(o);if(Date.now()-(s.createdAt||0)<=Pe)return s.lastSeen=Date.now(),localStorage.setItem(n,JSON.stringify(s)),s.convId;try{const l=await _e(e,s.convId);if(l!=null&&l.newConvId){const c={convId:l.newConvId,createdAt:Date.now(),lastSeen:Date.now()};return localStorage.setItem(n,JSON.stringify(c)),l.newConvId}}catch(l){console.warn("[Stacy] resumeConversation failed, will create new conv",l)}}const r=await xe(e,t),a=r==null?void 0:r.convId;if(!a)throw new Error("createConversation returned no convId");return localStorage.setItem(n,JSON.stringify({convId:a,createdAt:Date.now(),lastSeen:Date.now()})),a}catch(o){throw console.error("[Stacy] getOrCreateConvId error",o),o}}function V(e){var o,r;const t=((o=e==null?void 0:e.context)==null?void 0:o.currentPage)??{url:window.location.href,title:document.title,pageType:(e==null?void 0:e.pageType)??"unknown"},n=((r=e==null?void 0:e.context)==null?void 0:r.currentProduct)??null;return{currentPage:t,currentProduct:n}}function qe(e){var o,r,a,s;const t=V(e),n=j;if(!n||((o=n.currentPage)==null?void 0:o.url)!==((r=t.currentPage)==null?void 0:r.url)||(((a=n.currentProduct)==null?void 0:a.id)||null)!==(((s=t.currentProduct)==null?void 0:s.id)||null)){const i={currentPage:t.currentPage,previousPage:(n==null?void 0:n.currentPage)??null,currentProduct:t.currentProduct??null};return j=t,i}return null}function y(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Oe(e){try{const t=String(e).trim();if(/^(https?:|mailto:)/i.test(t))return t}catch{}return"#"}function $e(e){let t=y(e);return t=t.replace(/```([\s\S]*?)```/g,(n,o)=>`<pre class="stacy-code"><code>${y(o)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,o)=>`<code class="stacy-inline-code">${y(o)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,o,r)=>`<a href="${Oe(r)}" target="_blank" rel="noopener noreferrer">${y(o)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,o)=>`<strong>${y(o)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,o)=>`<em>${y(o)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function k(e,t){const n=document.querySelector("[data-stacy-messages]");if(!n)return null;const o=document.createElement("div");if(o.className="p-2 my-1 rounded-lg max-w-[85%] text-sm break-words",t==="user")o.classList.add("bg-primary/20","self-end"),o.textContent=e;else{o.classList.add("self-start");const r=getComputedStyle(document.documentElement).getPropertyValue("--chat-response-bg-color").trim()||"#f3f4f6";o.style.backgroundColor=r,o.innerHTML=$e(e)}return n.appendChild(o),n.scrollTop=n.scrollHeight,o}function De(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}async function Me({storeId:e,convId:t,message:n,contextDelta:o=null}){return ke(e,t,n,o)}function Fe(){var o;const e=J();if((o=e.stacyInitialMessage)!=null&&o.trim())return e.stacyInitialMessage.trim();const t=e.storeName||"la boutique",n=e.currentProduct||null;return n!=null&&n.title?`Salut — je suis Stacy, l'assistante de ${t}. Je vois que vous regardez "${n.title}". Besoin d'infos ?`:`Salut — je suis Stacy, l'assistante de ${t}. Comment puis-je vous aider aujourd'hui ?`}function ze(){if(Z)return;const e=Fe();k(e,"stacy"),H.push({role:"model",parts:[{text:e}]}),Z=!0}async function Ne(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const o=n.value.trim();if(!o)return;k(o,"user"),H.push({role:"user",parts:[{text:o}]}),n.value="",n.disabled=!0;const r=De();try{const a=J(),s=a.storeId,i=a.context||V(a),l=await Ae(s,i),c=qe(a),u=await Me({storeId:s,convId:l,message:o,contextDelta:c});r&&r.remove();const d=(u==null?void 0:u.answer)??"Désolé, je n'ai pas de réponse pour le moment.";k(d,"stacy"),H.push({role:"model",parts:[{text:d}]})}catch(a){r&&r.remove(),console.error("[Stacy] handleFormSubmit error",a),k("Désolé, une erreur est survenue. Veuillez réessayer.","stacy")}finally{n.disabled=!1,n.focus()}}function F(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!(!e||!t)&&(h=!h,e.classList.toggle("is-open",h),t.setAttribute("aria-expanded",String(h)),h)){const n=document.querySelector("[data-stacy-input]");n&&setTimeout(()=>n.focus(),50)}}function Re(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",F);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",Ne);const n=t.querySelector("[data-stacy-input]");n&&n.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",n=>{n.key==="Escape"&&h&&F(),(n.ctrlKey||n.metaKey)&&n.key.toLowerCase()==="k"&&(n.preventDefault(),F())})}function He(){Re(),ze(),j=V(J()),console.log("[Stacy] Module V4.3 initialisé. Synced & ready.")}function b(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function je(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun résultat trouvé. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>`
    <a href="${n.url}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${n.coverImage}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${n.price.amount.toFixed(2)} ${n.price.currency}</p>
      </div>
    </a>
  `).join("")}}async function Ue(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),o=document.getElementById("search-input"),r=document.getElementById("search-results");if(!e||!t||!o||!n||!r)return;const a=await A();e.addEventListener("click",b),n.addEventListener("click",b),o.addEventListener("input",()=>{const s=o.value.trim().toLowerCase();if(s.length<2){r.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caractères pour rechercher.</p>';return}const i=a.filter(l=>l.title.toLowerCase().includes(s)).slice(0,5);je(i)}),document.addEventListener("keydown",s=>{s.key==="Escape"&&!t.classList.contains("hidden")&&b()}),r.addEventListener("click",s=>{s.target.closest("a")&&b()})}function Je(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function Ve(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function We(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function Ke(){Je(),Ve(),We(),console.log("[GlobalUI] Module initialisé.")}const Ge={isScrolling:!1,init(){this.bindEventListeners(),window.addEventListener("popstate",()=>this.handleLocationChange()),console.log("[Router] Initialisé en mode SIXTH SENSE.")},handleLinkClick(e){if(this.isScrolling)return;const t=e.target.closest("a.zflex-link");if(!t||t.target==="_blank")return;const n=new URL(t.href);if(n.hash&&n.pathname===window.location.pathname){e.preventDefault();const o=document.querySelector(n.hash);o&&o.scrollIntoView({behavior:"smooth",block:"start"});return}n.origin===window.location.origin&&(e.preventDefault(),this.navigateTo(n.pathname))},bindEventListeners(){document.body.addEventListener("touchstart",()=>{this.isScrolling=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{this.isScrolling=!0},{passive:!0}),document.body.addEventListener("click",this.handleLinkClick.bind(this)),document.body.addEventListener("touchend",this.handleLinkClick.bind(this))},navigateTo(e){e!==window.location.pathname&&(history.pushState({path:e},"",e),this.handleLocationChange())},async handleLocationChange(){const e=window.location.pathname;console.log(`[Router] Navigation détectée vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),o=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}o&&o.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const r=await fetch(t);if(!r.ok){if(r.status===404){const i=await(await fetch("/content/404.html")).text();this.updatePageContent(i,"404 - Page non trouvée");return}throw new Error(`Erreur serveur: ${r.statusText}`)}const a=await r.text();this.updatePageContent(a)}catch(r){console.error("Erreur de routage critique:",r),n.innerHTML=`
        <div class="text-center py-20">
          <h1 class="text-2xl font-bold">Erreur de chargement</h1>
          <p class="text-gray-600 mt-2">${r.message}</p>
          <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
        </div>
      `}finally{o&&o.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.scrollTo(0,0)}},updatePageContent(e,t=null){const n=document.getElementById("app-content"),o=document.getElementById("zflex-data"),s=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(s&&o){const i=s.querySelector(".zflex-fragment-data");i&&(o.textContent=i.textContent,i.remove()),document.title=t||s.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(s),me()}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}};function Qe(){const e=document.getElementById("newsletter-form");e&&e.addEventListener("submit",async t=>{t.preventDefault();const n=e.querySelector('input[type="email"]').value;re("Merci !",`Vous êtes maintenant inscrit avec l'adresse : ${n}`,"success"),e.reset()})}let w;function Ye(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Xe,{once:!0}))}function ie(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Xe(){if(!w)return;w.prompt();const{outcome:e}=await w.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accepté l'installation."),ie()):console.log("[PWA] L'utilisateur a refusé l'installation."),w=null}function Ze(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] Détecté comme une application installée."),ie()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),w=e,Ye()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}const ce="zflex_analytics_queue_v1",et=5e3,le=50,tt=3;let f=[],C=!1;function nt(){try{const e=localStorage.getItem(ce);if(!e)return;const t=JSON.parse(e);Array.isArray(t)&&(f=t)}catch(e){console.warn("[Analytics] impossible de charger la queue:",e),f=[]}}function T(){try{localStorage.setItem(ce,JSON.stringify(f))}catch(e){console.warn("[Analytics] persist failed:",e)}}function z(e,t={}){const n=ue()||{},o={type:e,payload:t,storeId:n.storeId||null,page:n.pageType||null,ts:new Date().toISOString(),version:n.zflex_version||null};f.push(o),T()}async function de(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId||null,o={storeId:n,events:e};return await Be(n,e)}catch(n){return console.warn(`[Analytics] sendBatch failed (attempt ${t}):`,n),t<tt?(await new Promise(o=>setTimeout(o,500*t)),de(e,t+1)):{ok:!1,error:String(n)}}}async function U(){if(!C&&f.length!==0){C=!0;try{const e={};for(const t of f){const n=t.storeId||"__unknown__";e[n]=e[n]||[],e[n].push(t)}for(const t of Object.keys(e)){const n=e[t];for(;n.length>0;){const o=n.splice(0,le),r=await de(o);if(r&&r.ok)f=f.filter(a=>!o.some(s=>s.ts===a.ts&&s.type===a.type&&a.storeId===t));else{console.error("[Analytics] batch failed permanently:",r==null?void 0:r.error),T(),C=!1;return}}}T()}finally{C=!1}}}let ee=null;function ot(){ee||(ee=setInterval(U,et)),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&U()}),window.addEventListener("beforeunload",()=>{try{const e=f.slice(0,le);if(e.length===0)return;const t=JSON.stringify({storeId:e[0].storeId,events:e});if(navigator.sendBeacon){const n=window.zflexApiEndpoints&&window.zflexApiEndpoints.trackEvent||null;n&&(navigator.sendBeacon(n,t),f=f.filter(o=>!e.some(r=>r.ts===o.ts&&r.type===o.type)),T())}}catch{}})}function rt({sampleRate:e=1}={}){nt(),ot(),z("pageview",{url:location.pathname+location.search+location.hash,title:document.title}),S.addEventListener("cart:added",t=>{z("add_to_cart",t.detail||{})}),window.zflexAnalytics={track:z,flush:U,queueLength:()=>f.length}}let te=!1,E=null;function ue(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[App] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[App] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}const ne={"product-detail":async()=>{const{initProductGallery:e}=await L(async()=>{const{initProductGallery:t}=await import("../assets/product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return be(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await L(async()=>{const{initFilterSort:t}=await Promise.resolve().then(()=>ve);return{initFilterSort:t}},void 0);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(Le(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await L(async()=>{const{initCheckout:t}=await import("../assets/checkout-DZo7m2Ri.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await L(async()=>{const{initOrderSuccess:t}=await import("../assets/order-success-Cpxqdj56.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function me(){var o;E&&typeof E.destroy=="function"&&E.destroy();const e=document.querySelector("#app-content main"),t=((o=e==null?void 0:e.dataset)==null?void 0:o.pageType)||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=ne[t]||ne.unknown;try{E=await n()}catch(r){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,r),E=null}Qe()}function oe(){if(te)return;console.log("[App] Démarrage zFlex — L'Architecture Finale.");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas été chargé. Vérifie les scripts dans _head.njk.");const t=document.getElementById("firebase-config-data");if(!t)throw new Error("Firebase config data island not found.");const n=JSON.parse(t.textContent||"{}");if(!n.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(n),console.log("[Firebase] Initialisation via le scope global réussie. La guerre est finie.")}catch(t){console.error("[Firebase] ÉCHEC CRITIQUE DE L'INITIALISATION :",t);return}Ce(),He(),Ke(),Ue(),Ee(),Ze(),rt(),Ge.init(),me(),te=!0;const e=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",e),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",oe,{once:!0}):oe();export{L as _,at as a,ct as b,it as c,I as g};
