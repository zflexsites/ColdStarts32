import{g as f,c as h,a as g}from"../js/app.js";function b(a){const n=document.getElementById("summary-items-list"),r=document.getElementById("summary-subtotal"),o=document.getElementById("summary-total");if(!n||!r||!o)return;if(a.length===0){n.innerHTML='<p class="text-sm text-center">Votre panier est vide. <a href="/" class="underline zflex-link">Retournez faire des achats</a>.</p>',document.getElementById("submit-order-btn").disabled=!0;return}n.innerHTML="";let c={};a.forEach(e=>{const t=document.createElement("div");t.className="flex justify-between text-sm",t.innerHTML=`
      <div>
        <span class="font-semibold">${e.quantity} x</span> ${e.title}
      </div>
      <span style="color: var(--text-color);">${(e.price.amount*e.quantity).toFixed(2)} ${e.price.currency}</span>
    `,n.appendChild(t);const s=e.price.currency;c[s]||(c[s]=0),c[s]+=e.price.amount*e.quantity}),r.innerHTML="",o.innerHTML="",Object.entries(c).forEach(([e,t])=>{const s=`${Number(t).toFixed(2)} ${e}`;r.innerHTML+=`<div>${s}</div>`,o.innerHTML+=`<div>${s}</div>`})}function L(){const a=document.getElementById("checkout-form");if(!a)return;const n=f();b(n);const r=document.getElementById("submit-order-btn"),o=document.getElementById("checkout-error");a.addEventListener("submit",async c=>{var e;if(c.preventDefault(),n.length!==0){r.disabled=!0,r.querySelector(".btn-text").classList.add("hidden"),r.querySelector(".btn-spinner").classList.remove("hidden"),o.classList.add("hidden");try{const t=new FormData(a),s={name:t.get("name"),phone:t.get("phone"),address:t.get("address"),notes:t.get("notes")},d=document.getElementById("zflex-data");if(!d)throw new Error("Données de page introuvables.");const u=JSON.parse(d.textContent).storeId,l=n.reduce((p,i)=>p+i.price.amount*i.quantity,0),m={customer:s,items:n,total:l,currency:((e=n[0])==null?void 0:e.price.currency)||"EUR"},y=(await h(m,u)).orderId;g(),window.location.href=`/order-success/?id=${y}`}catch(t){console.error("[Checkout] Erreur lors de la soumission de la commande:",t),o.textContent=t.message||"Une erreur est survenue. Veuillez réessayer.",o.classList.remove("hidden"),r.disabled=!1,r.querySelector(".btn-text").classList.remove("hidden"),r.querySelector(".btn-spinner").classList.add("hidden")}}}),console.log("[Checkout] Module initialisé.")}export{L as initCheckout};
